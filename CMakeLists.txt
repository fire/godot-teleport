cmake_minimum_required(VERSION 3.8)
set_property(GLOBAL PROPERTY USE_FOLDERS ON)
project(RemotePlay)
set( SIMUL "C:/Simul/4.2/Simul" CACHE STRING "Simul folder" )

set(CMAKE_CXX_STANDARD 17 )
set(CMAKE_CXX_STANDARD_REQUIRED ON )
set(CMAKE_CXX_EXTENSIONS ON )
set(CMAKE_CXX_FLAGS_RELEASE "/Od /Ob0 /Zi")
set(CMAKE_CXX_FLAGS_DEBUG "/Zi /Ob0 /Od /RTC1")
set(CMAKE_SHARED_LINKER_FLAGS_RELEASE "${CMAKE_SHARED_LINKER_FLAGS_RELEASE} /DEBUG /OPT:REF /OPT:ICF")
SET(CMAKE_STATIC_LINKER_FLAGS_RELEASE "${CMAKE_STATIC_LINKER_FLAGS_RELEASE}")
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /DEBUG")

set(CONFIG_NAME $<$<CONFIG:Debug>:Debug>$<$<CONFIG:Release>:Release>)
#message(STATUS "CONFIG_NAME ${CONFIG_NAME}")

function(set_target_runtime targname rt)
	# Default to statically-linked runtime.
	if("${rt}" STREQUAL "")
		set(rt "static")
	endif()
	#message(STATUS "rt ${rt}")
	if(${rt} STREQUAL "static")
		SET_TARGET_PROPERTIES(${targname} PROPERTIES COMPILE_OPTIONS "/MT$<$<CONFIG:Debug>:d>")
	else()	
		SET_TARGET_PROPERTIES(${targname} PROPERTIES COMPILE_OPTIONS "/MD$<$<CONFIG:Debug>:d>")
	endif()
endfunction()

function(SetDefaults targname)
	set_target_properties( ${targname} PROPERTIES PREFIX "" )
	add_definitions(-DUNICODE -D_UNICODE)
	if(MSVC)
		target_compile_options(${targname} PRIVATE /W3 /wd4011 /wd4514 )
	else()
		target_compile_options(${targname} PRIVATE -Wall -Wextra -pedantic -Werror )
	endif()
endfunction()

function(add_static_library targname)
  add_library(${ARGV})
  set_target_runtime(${targname} static)
  SetDefaults( ${targname} )
endfunction()

function(add_static_executable targname)
	add_executable(${ARGV})
	message( STATUS set_target_runtime ${targname})
	set_target_runtime(${targname} static)
	SetDefaults( ${targname} )
endfunction()

add_subdirectory(pc_client)
add_subdirectory(libavstream)
add_subdirectory(thirdparty/enet)
add_subdirectory(thirdparty/basis_universal)
add_subdirectory(SimulCasterRenderer)
add_subdirectory(SimulCasterServer)